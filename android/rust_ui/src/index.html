<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SharkOS</title>
    <style>
      /* Theme mapped from Rust/egui theme constants */
      :root{
        --bg: #0a0a0a;               /* DEFAULT_DARK_COLOR */
        --bg-panel: #141414;         /* DEFAULT_DARK_COLOR_BG */
        --text: #ffffff;             /* DEFAULT_DARK_COLOR_TEXT */
        --muted: #d6daf5;            /* UNHOVERED_DARK_TEXT_COLOR */
        --accent: #0ea5e9;           /* DEFAULT_DARK_QUATERNARY_COLOR */
        --danger: #dc2626;           /* DEFAULT_DARK_SECONDARY_COLOR */
        --tertiary: #8c00ff;         /* DEFAULT_DARK_TERTIARY_COLOR */
        --quinary: rgba(130,242,255,0.18); /* DEFAULT_DARK_QUINARY_COLOR */
        --senary: rgba(216,139,255,0.18);  /* DEFAULT_DARK_SENARY_COLOR */
        --quinary-darker: #244245;  /* DEFAULT_DARK_QUINARY_COLOR_DARKER */
        --senary-darker: #3d2847;    /* DEFAULT_DARK_SENARY_COLOR_DARKER */
        --light: #f5f5f5;            /* DEFAULT_LIGHT_COLOR */
        --light-secondary: #dc2626;  /* DEFAULT_LIGHT_SECONDARY_COLOR */
        --glass: rgba(255,255,255,0.03);
        --card: #15181a;
        --success: #39ff9b;
        font-family: 'SpaceGrotesk', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      }

      html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
      /* constrain app to viewport so chart pages fit the device */
      .app{height:100vh;width:100vw;max-width:none;margin:0 auto;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:0;box-shadow:none;display:flex;flex-direction:column;overflow:hidden;}
      header{flex:0 0 auto}
      header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
      header h1{margin:0;font-size:20px;color:var(--accent)}
      .toolbar{margin-left:auto;display:flex;gap:8px}
      .btn{border:1px solid rgba(255,255,255,0.06);background:var(--card);color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
      .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
      /* disabled / playing states */
      .btn[disabled]{opacity:.45;cursor:default;filter:grayscale(.2)}
      .btn.playing{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));border:1px solid rgba(0,0,0,0.2);}
      #recordBtn.recording{color:#ff4d4d;box-shadow:0 6px 20px rgba(255,77,77,0.08)}

      /* Main menu grid (2 x 8) */
      #main-menu{display:grid;grid-template-columns:repeat(2,1fr);grid-auto-rows:56px;gap:12px}
      .menu-btn{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg-panel),rgba(255,255,255,0.01));border-radius:10px;border:1px solid rgba(255,255,255,0.03);color:var(--text);font-weight:700;font-size:14px;cursor:pointer;box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)}
      .menu-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,0.5)}
      .menu-btn.selected{background:linear-gradient(180deg,var(--quinary),transparent);border-color:var(--quinary-darker);box-shadow:0 10px 30px rgba(0,0,0,0.6);outline:2px solid rgba(255,255,255,0.02)}
      .menu-grid-title{color:var(--muted);font-size:12px;margin-bottom:0}

      /* Chart / templates */
      #chart-screen{display:flex;flex:1;gap:12px;min-height:0;overflow:hidden}
      .panels{background:var(--bg-panel);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.03);box-sizing:border-box;display:flex;flex-direction:column;min-height:0}
      .chart-main{flex:2;min-width:0}
      .log-panel{flex:1;min-width:0}
      /* make chart canvas area scrollable/zoomable but allow it to stretch to available space */
      .chart-canvas{display:block;width:100%;height:100%;background:transparent}
      .chart-inner{min-width:100%;width:100%;flex:1;min-height:0;display:block}
      .zoom-container{overflow:auto;flex:1;min-height:0}
      .zoomable-container canvas{transform-origin:center center;height:100%}
      #cell-scan-output{flex:1;min-height:0;overflow:auto;font-family:monospace;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.02)}
      .small-ctrl{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);cursor:pointer;margin:0 6px;font-weight:700}
      .hidden{display:none}

      /* Submenu styling (use accent colors for visual hints) */
      .submenu {display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
      .submenu .menu-btn{padding:12px 8px;font-size:13px;border:1px solid rgba(255,255,255,0.04)}
      .submenu.ble .menu-btn{border-color:var(--tertiary)}
      .submenu.wifi .menu-btn{border-color:var(--danger)}

      /* Responsive */
      @media(max-width:900px){#chart-screen{flex-direction:column} .chart-canvas{height:180px} .chart-main,.log-panel{flex:1}} 
      /* Ensure chart-screen children can shrink inside flex container */
      #chart-screen{min-height:0}
      .panels{overflow:hidden}

      /* Menus and submenus should scroll as full-page lists */
      #main-menu, .submenu, #wifi-menu, #ble-menu, #sub-ghz-menu { overflow:auto; flex:1; min-height:0; }

      /* Device picker modal */
      #device-picker-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:1000;padding:24px}
      #device-picker{
        width:720px;
        max-width:calc(100% - 48px);
        min-height:220px;
        background:var(--bg-panel);
        border-radius:12px;
        padding:20px;
        box-sizing:border-box;
        border:1px solid rgba(255,255,255,0.04);
        box-shadow:0 8px 40px rgba(0,0,0,0.6);
      }
      #device-picker select{
        width:100%;
        padding:10px;
        min-height:46px;
        border-radius:8px;
        background:transparent;
        border:1px solid rgba(255,255,255,0.04);
        color:var(--text);
        font-weight:600;
        white-space:nowrap; /* prevent wrapping inside select */
        overflow:hidden;
        text-overflow:ellipsis;
      }
      #device-picker .btn{min-width:120px}
      @media(max-width:640px){
        #device-picker{width:calc(100% - 32px);max-height:calc(100% - 48px);overflow:auto;padding:16px}
      }

      [hidden] {
        display: none !important;
      }
      section{min-height:0}
    </style>
  </head>
  <body>
    <div class="app">
      <header>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="backBtn" class="btn secondary">◀ Back</button>
          <button id="recordBtn" class="btn" title="Record">●</button>
          <button id="playBtn" class="btn" title="Play">▶</button>
          <button id="stopBtn" class="btn" title="Stop">■</button>
        </div>
        <!-- sub‑GHz header controls: moved here so they appear beside play/stop/record -->
        <div id="subghz-header-controls" style="display:none;flex-direction:column;gap:4px;margin-left:12px">
          <div style="display:flex;align-items:center;gap:8px">
            <label style="color:var(--muted);font-size:13px;margin-right:6px">High</label>
            <button id="subghzFreqDown1" class="small-ctrl" aria-label="decrease frequency">−</button>
            <input id="subghzFreqInput1" type="number" min="300" max="1000" step="0.1" value="433.0" style="width:120px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);font-weight:700;text-align:center" />
            <button id="subghzFreqUp1" class="small-ctrl" aria-label="increase frequency">+</button>
            <label style="color:var(--muted);font-size:13px;margin-right:6px">MHz</label>
            <select id="subghzModSelect1" style="padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);font-weight:700">
              <option value="OOK">OOK</option>
              <option value="2-FSK">2-FSK</option>
              <option value="ASK">ASK</option>
              <option value="GFSK">GFSK</option>
              <option value="MSK">MSK</option>
              <option value="LoRa">LoRa</option>
            </select>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <label style="color:var(--muted);font-size:13px;margin-right:6px">Low</label>
            <button id="subghzFreqDown2" class="small-ctrl" aria-label="decrease frequency">−</button>
            <input id="subghzFreqInput2" type="number" min="300" max="1000" step="0.1" value="400.0" style="width:120px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);font-weight:700;text-align:center" />
            <button id="subghzFreqUp2" class="small-ctrl" aria-label="increase frequency">+</button>
            <label style="color:var(--muted);font-size:13px;margin-right:6px">MHz</label>
            <select id="subghzModSelect2" style="padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);font-weight:700">
              <option value="2-FSK">2-FSK</option> 
              <option value="OOK">OOK</option>
              <option value="4-FSK">4-FSK</option>
              <option value="GFSK">GFSK</option>
              <option value="ASK">ASK</option>
              <option value="MSK">MSK</option>
            </select>
          </div>
        </div>
        
        <!-- Wi-Fi header controls -->
        <div id="wifi-header-controls" style="display:none;align-items:center;gap:8px;margin-left:12px">
          <select id="wifiBandSelect" style="padding:4px;border-radius:6px;background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.1)">
            <option value="2.4">2.4 GHz</option>
            <option value="5" hidden>5 GHz</option>
          </select>
          <select id="wifiChannelSelect" style="padding:4px;border-radius:6px;background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.1);min-width:60px">
            <option value="all">All Channels</option>
          </select>
        </div>
        <h1>SharkOS</h1>
        <div class="toolbar">
          <div id="connectedDevice" style="color:var(--muted);font-size:14px">No device connected</div>
          <button id="requestPermsBtn" class="btn">Choose Device</button>
        </div>
      </header>

      <!-- Device picker modal -->
      <div id="device-picker-overlay" hidden=true role="dialog" aria-modal="true">
        <div id="device-picker">
          <h3 style="margin-top:0;color:var(--muted)">Select Bluetooth Device</h3>
          <div style="margin:12px 0;">
            <select id="deviceSelect" aria-label="Paired Bluetooth devices"></select>
          </div>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button id="refreshDeviceBtn" class="btn secondary">Refresh</button>
            <button id="cancelDeviceBtn" class="btn secondary">Cancel</button>
            <button id="saveDeviceBtn" class="btn">Save</button>
            <button id="openBTScreenBtn" class="btn">Open Bluetooth Connection Screen</button>
          </div>
          <div id="devicePickerMsg" style="margin-top:8px;color:var(--muted);font-size:12px"></div>
        </div>
      </div>

      <!-- MAIN MENU: 2 x 8 grid of buttons -->
      <section id="main-menu" aria-label="main-menu" class="menu active">
        <div class="menu-grid-title"></div>
        <div class="menu-grid-title"></div>

        <button class="menu-btn" data-action="wifi">Wi‑Fi</button>
        <button class="menu-btn" data-action="ble">BLE</button>
        <button class="menu-btn" data-action="subghz">Sub‑GHz</button>
        <button class="menu-btn" data-action="nrf-disruptor">nRF Disruptor</button>
        <button class="menu-btn" data-action="nrf-scanner">nRF Scanner</button>
        <button class="menu-btn" data-action="nfc">NFC</button>
        <button class="menu-btn" data-action="cell-scan">Cell Scan</button>
        <button class="menu-btn" data-action="infrared">Infrared</button>
        <button class="menu-btn" data-action="gpio">GPIO</button>
        <button class="menu-btn" data-action="apps">Apps</button>
        <button class="menu-btn" data-action="bad-usb">Bad USB</button>
        <button class="menu-btn" data-action="remotes">Universal Remotes</button>
        <button class="menu-btn" data-action="oscilloscope">Oscilloscope</button>
        <button class="menu-btn" data-action="wifi-scan">Wi‑Fi Scan</button>
        <button id="systemInfoBtn" class="menu-btn">System Info</button>
        <button class="menu-btn" data-action="settings">Settings</button>
        <button class="menu-btn" data-action="about">About</button>
      </section>

      <!-- BLE Submenu -->
      <section id="ble-menu" hidden=true>
        <div class="menu-grid-title">BLE</div>
        <div class="menu-grid-title"></div>
        <div class="submenu ble">
          <button class="menu-btn" data-action="ble-scanner">Scanner</button>
          <button class="menu-btn" data-action="ble-packet-sender">Packet Sender</button>
          <button class="menu-btn" data-action="ble-spoof">Spoof Device</button>
        </div>
      </section>

      <!-- Wi‑Fi Submenu -->
      <section id="wifi-menu" hidden=true>
        <div class="menu-grid-title">Wi‑Fi</div>
        <div class="menu-grid-title"></div>
        <div class="submenu wifi">
            <button class="menu-btn" data-action="wifi-scanner">Scanner</button>
            <button class="menu-btn" data-action="wifi-channel-scan">Channel Scan</button>
          <button class="menu-btn" data-action="wifi-deauth">Deauth</button>
          <button class="menu-btn" data-action="wifi-spoofer">Spoofer</button>
          <button class="menu-btn" data-action="wifi-packet-sender">Packet Sender</button>
          <button class="menu-btn" data-action="wifi-restful">RESTful Request</button>
        </div>
      </section>
      <section id="sub-ghz-menu" hidden=true>
        <div class="menu-grid-title">Sub‑GHz</div>
        <div class="menu-grid-title"></div>
        <div class="submenu sub-ghz">
          <button class="menu-btn" data-action="sub-ghz-scanner">Scanner</button>
          <button class="menu-btn" data-action="sub-ghz-playback">Playback</button>
          <button class="menu-btn" data-action="sub-ghz-recorder">Recorder</button>
          <button class="menu-btn" data-action="sub-ghz-packet-sender">Packet Sender</button>
          <button class="menu-btn" data-action="sub-ghz-disruptor">Disruptor</button>
        </div>
      </section>

      <!-- CHART / LOG SCREEN -->
      <section id="chart-screen" class="chart-screen hidden" hidden=true>
        <div class="panels chart-main">

          <!-- sub‑GHz scanner controls moved to header (subghz-header-controls) -->

              <!-- Separate charts, but only one shown at a time -->
              <div id="signal-panel" class="panels" style="flex:1; margin-bottom:0;">
                <div class="zoom-container">
                  <div class="chart-inner">
                    <canvas id="signalChart" class="chart-canvas"></canvas>
                  </div>
                </div>
              </div>

              <div id="channels-panel" class="panels hidden" hidden=true style="flex:1; margin-top:0;">
                <div class="zoom-container">
                  <div class="chart-inner">
                    <canvas id="channelsChart" class="chart-canvas"></canvas>
                  </div>
                </div>
              </div>
        </div>

        <aside class="panels log-panel">
          <pre id="cell-scan-output" style="overflow:auto;background:transparent;color:var(--success);padding:8px;border-radius:6px;font-family:monospace"></pre>
        </aside>
      </section>

      <!-- STATUS SCREEN: show results of status.info queries -->
      <section id="status-screen" style="margin-top:14px" class="hidden" hidden=true>
        <div class="panels" style="flex-direction:column;gap:12px;">
          <h3 style="margin-top:0;color:var(--muted)">Device Status</h3>
          <div id="status-content" style="display:flex;flex-wrap:wrap;gap:12px;"></div>
        </div>
      </section>

      <!-- SENSOR CHART (kept for compatibility with existing code) -->
      <section id="sensor-panel" style="margin-top:14px" class="hidden" hidden=true>
        <div class="panels">
          <h3 style="margin-top:0;color:var(--muted)">Sensor Live (accelerometer)</h3>
          <div id="chart-container"><canvas id="sensorChart" class="chart-canvas"></canvas></div>
        </div>
      </section>

      <!-- footer intentionally removed so it doesn't overlay charts -->
    </div>

    <script type="module" src="/main.ts"></script>
  </body>
</html>
